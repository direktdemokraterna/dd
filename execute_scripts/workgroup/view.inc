<?php

if(isset($_POST['type'])){

	if($_POST['type']=="cancel_exclude"){
		$ok = db_workgroup::cancel_exclude($_POST['id'], $_POST['user'], $_SESSION['id']);
		if($ok){
			$_SESSION['report_message'] = "Ditt std fr uteslutning har tagits tillbaka.";
		}
	}
	elseif($_POST['type']=="support_exclude"){
		$ok = db_workgroup::support_exclude($_POST['id'], $_POST['user'], $_SESSION['id']);
		$excluded = db_workgroup::calculate_exclusion($_POST['id'], $_POST['user']);
		if($excluded == "excluded"){
			$_SESSION['report_message'] = "Du har sttt en uteslutning. Medlemmen i frga r numera utesluten.";
		}
		elseif($excluded == "still member"){
			$_SESSION['report_message'] = "Du har sttt en uteslutning. Medlemmen i frga r fortfarande gruppmedlem.";
		}
	}
	elseif($_POST['type']=="cancel_support_candidate"){
		$ok = db_workgroup::cancel_support($_POST['id'], $_POST['user'], $_SESSION['id']);
		if($ok){
			$_SESSION['report_message'] = "Ditt std fr medlemskap har tagits tillbaka.";
		}
	}
	elseif($_POST['type']=="support_candidate"){
		$ok = db_workgroup::support_membership($_POST['id'], $_POST['user'], $_SESSION['id']);
		$affirmed = db_workgroup::check_candidate_support($_POST['id'], $_POST['user']);
		if($affirmed == "new member"){
			$_SESSION['report_message'] = "Du har sttt en kandidatur. Kandidaten r numera medlem.";
		}
		elseif($affirmed == "still candidate"){
			$_SESSION['report_message'] = "Du har sttt en kandidatur. Kandidaten behver fortfarande mer std.";
		}

	}
	elseif($_POST['type']=="submit_candidacy"){
		$ok = db_workgroup::submit_candidacy($_POST['id'], $_SESSION['id']);
		if($ok) $_SESSION['report_message'] = "Din medlemsanskan r registrerad.";
	}

	elseif($_POST['type']=="cancel_candidacy"){
		$ok = db_workgroup::cancel_candidacy($_POST['id'], $_SESSION['id']);
		if($ok) $_SESSION['report_message'] = "Din medlemsanskan r borttagen.";
	}

	elseif($_POST['type']=="support_workgroup"){
		$ok = db_workgroup::add_supporting_member($_POST['id'], $_SESSION['id']);
		if($ok){
			$created = db_workgroup::is_active($_POST['id']);
			if($created==1){
				$_SESSION['report_message'] = "Arbetsgruppen r nu aktiverad och du r upptagen som medlem.";
			}
			else{
				$_SESSION['report_message'] = "Din medlemsanskan har registrerats.";
			}
		} 
	}
	elseif($_POST['type']=="cancel_support_workgroup"){
		$ok = db_workgroup::remove_supporting_member($_POST['id'], $_SESSION['id']);
		if($ok) $_SESSION['report_message'] = "Du stdjer inte lngre denna arbetsgrupps aktivering.";
	}

	elseif($_POST['type']=="cancel_membership"){
		$ok = db_workgroup::drop_member($_POST['id'], $_SESSION['id']);
		if($ok) $_SESSION['report_message'] = "Du r inte lngre medlem i denna arbetsgrupp.";
	}

	if(!empty($_SESSION['report_message'])){
		$redirect = $_SERVER['REQUEST_URI'];
	}

}
	
?>